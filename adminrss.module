<?php
/**
 * @file
 * Creator: James Blake <james at webgeer dot com>
 *
 * Drupal 5, 6, 7 and 8 versions: Frederic G. MARAND <fgm at osinet dot fr>
 *
 * Enables one to view pending items (node, comments, ...) using an RSS reader.
 *
 * This module was made a lot easier for me (webgeer) by both adminblock.module
 * and commentrss.module. Thanks to both Fredrik Jonsson and GÃ¡bor Hojtsy.
 *
 * @link http://drupal.org/project/adminblock
 * @link http://drupal.org/project/commentrss
 *
 * @since DRUPAL-4-6
 * @license General Public License version 2.0 and later
 */

use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function adminrss_help($path, RouteMatchInterface $routeMatch) {
  switch ($path) {
    case 'help.page.adminrss':
      $types = implode(', ', array_map(function ($info) {
        return $info['title'];
      }, adminrss_feeds()));
      $ret = t('Provide RSS feeds for administrative items: %types.', array('%types' => $types));
      break;

    default:
      $ret = NULL;
  }

  return $ret;
}

/**
 * Return information about existing Admin RSS feeds.
 *
 * @return array
 *   A machine-name-indexed hash of feed plugins.
 *     - only ony key: "configure", boolean: expose a configuration form.
 */
function adminrss_feeds() {
  $manager = \Drupal::service('plugin.manager.adminrss.feed');
  return $manager->getDefinitions();
}

/**
 * Return the path for a given feed.
 *
 * @param string $name
 *   Machine name of the feed.
 *
 * @return string
 *   Internal path to the feed, secret key included in plain sight.
 */
function adminrss_get_feed_path($name) {
  $token = \Drupal::config(\Drupal\adminrss\AdminRss::CONFIG)
    ->get(\Drupal\adminrss\AdminRss::TOKEN);
  $ret = ADMINRSS_PATH_HOME . "/$name/$token";
  return $ret;
}
